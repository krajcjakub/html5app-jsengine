<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<title>data sync</title>
	<link rel="stylesheet" type="text/css" href="styles/bootstrap.css" />
	<link rel="stylesheet" type="text/css" href="styles/def-styles.css" />
	<script src="js/LocalStorage/LocalStorage.js"></script>
	<script src="js/LocalStorage/LocalStorageIndexedDB.js"></script>
	<script src="js/LocalStorage/LocalStorageWebSQL.js"></script>
	<script src="js/DataSync/DataSync.js"></script>
	<script src="js/DataSync/SyncLogger.js"></script>
	<script>
	/*	----------------------------------
		Screen logic
		---------------------------------- */
		function oSelect(){
			this.id = function(id){
				return document.getElementById(id);
			}

			this.className = function(className){
				return document.getElementsByClassName(className);
			}			
		}

		var O = new oSelect();


		function showScreen(screenID){
			var screens = O.className("screen");
			for (var i = 0; i< screens.length; i++){
				screens[i].style.display = "none";
			}
			O.id(screenID).style.display = "block";
		}

	/*	--------------------------------------- 
		Form Logic
		--------------------------------------- */	

		function saveCar(){
			//var form = O.id("carForm").serialize();//.serializeArray();
			var form = {
				"table" : "cars",
				"id" : parseInt(O.id('inputCarId').value),
				"name" : O.id('inputCarName').value
        		};
			LStorage.set(form, function(){
				ReloadCars();
			});
		}

		function ReloadCars(){
			O.id("CarsListTable").innerHTML = "";
			LStorage.getAll({"table":"cars"},function(dataObj){
				O.id("CarsListTable").innerHTML = O.id("CarsListTable").innerHTML + '<tr><td>' + dataObj.id + '</td><td>' + dataObj.name + '</td><td><a href="javascript:EditCar('+dataObj.id+')">Edit</a> | <a href="javascript:DeleteCar('+dataObj.id+')">Delete</a></td></tr>';
			});
		}

		function EditCar(id){
			LStorage.get({"table":"cars", "id": id},function(dataObj){
				O.id('inputCarId').value = dataObj.id;
				O.id('inputCarName').value = dataObj.name;
			});
		}

		function DeleteCar(id){
			//var form = O.id("carForm").serialize();//.serializeArray();
			LStorage.remove({'table': 'cars', 'id': id}, function(){
				ReloadCars();
			});
		}


	/*	----------------------------------
		Page scripts
		---------------------------------- */
		var DSO;
		var LStorage;

		window.onload = function(){
			DSO = new DataSyncObj();
	
			LStorage = new LocalStorage(DSO);
			setTimeout(function(){
				ReloadCars();
				//DSO.pullFromRemote();
			},2000);
		}	
	</script>	
</head>
<body>
	<nav>
		<ul>
			<li><a href="javascript:showScreen('DashBoard');">Home</a></li>
			<li><a href="javascript:showScreen('CarsList');">Cars</a></li>
			<li><a href="javascript:showScreen('CarsEdit');">New car</a></li>
			<li><a href="javascript:showScreen('PlayersList');">Players</a></li>
			<li><a href="javascript:showScreen('PlayersEdit');">New Player</a></li>
		</ul>
	</nav>
	<div class="center">
		<section id="DashBoard" class="screen">
			<h2>Dashboard</h2>
			
		</section>
		<section id="CarsList" class="screen">
			<h2>Cars</h2>
			<div class="table-wrapper">
				<div class="table-responsive">
					<table class="table table-condensed">
						<thead>
							<tr>
								<th>Id</th>
								<th>Name</th>
							</tr>
						</thead>
						<tbody id="CarsListTable">
							
						</tbody>
					</table>
				</div>
			</div>	
		</section>
		<section id="CarsEdit" class="screen">
			<h2>New Car</h2>
			<form id="carForm" role="form">
				<div class="form-group">
					<label class="sr-only" for="inputCarId">Email address</label>
					<input type="email" class="form-control" id="inputCarId" value="0" placeholder="Enter carId or 0">
				</div>
				<div class="form-group">
					<label class="sr-only" for="inputCarName">Email address</label>
					<input type="text" class="form-control" id="inputCarName" placeholder="Enter carName">
				</div>
				<input type="button" value="add/save" class="btn btn-default" onclick="saveCar();" />
			</form>
		</section>
		<section id="PlayersList" class="screen">
			<h2>Player</h2>

		</section>
		<section id="PlayersEdit" class="screen">
			<h2>New Player</h2>
		</section>
	</div>
	<footer>&copy;2014 by Jakub Krajƒç</footer>
</body>
</html>
